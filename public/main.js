class A{skyWidth;skyHeight;stars;backgroundStars;time=0;constructor(j,B){this.skyWidth=j,this.skyHeight=B,this.stars=this.generateStars(800),this.backgroundStars=this.generateBackgroundStars(200)}generateStars(j){let B=[],Q=12345,J=()=>{return Q=Q*1103515245+12345&2147483647,Q/2147483647};for(let U=0;U<j;U++)B.push({x:J()*this.skyWidth,y:J()*this.skyHeight,size:J()*2+0.5,brightness:J()*0.5+0.5,twinkleOffset:J()*Math.PI*2});return B}generateBackgroundStars(j){let B=[],Q=67890,J=()=>{return Q=Q*1103515245+12345&2147483647,Q/2147483647};for(let U=0;U<j;U++)B.push({x:J()*this.skyWidth,y:J()*this.skyHeight,size:J()*1.5+0.3,brightness:J()*0.6+0.2,twinkleOffset:J()*Math.PI*2});return B}getBackgroundStars(){return this.backgroundStars}render(j,B,Q,J,U,V){this.time+=0.016;let Z=j.createRadialGradient(V.x,V.y,0,V.x,V.y,400);Z.addColorStop(0,"#0f1020"),Z.addColorStop(0.5,"#0a0a18"),Z.addColorStop(1,"#050510"),j.fillStyle=Z,j.fillRect(0,0,J,U);for(let F of this.stars){let K=F.x-B+J/2,M=F.y-Q+U/2;if(K<-50||K>J+50||M<-50||M>U+50)continue;let $=Math.sin(this.time*2+F.twinkleOffset)*0.2+0.8,q=F.brightness*$;this.drawStar(j,K,M,F.size,q)}}drawStar(j,B,Q,J,U){let V=j.createRadialGradient(B,Q,0,B,Q,J*4);V.addColorStop(0,`rgba(200, 210, 255, ${U*0.3})`),V.addColorStop(0.5,`rgba(200, 210, 255, ${U*0.1})`),V.addColorStop(1,"rgba(200, 210, 255, 0)"),j.beginPath(),j.arc(B,Q,J*4,0,Math.PI*2),j.fillStyle=V,j.fill(),j.beginPath(),j.arc(B,Q,J,0,Math.PI*2),j.fillStyle=`rgba(255, 255, 255, ${U})`,j.fill()}}class I{element;currentX;currentY;targetX;targetY;radius;lagFactor=0.08;maxLag=50;constructor(j){this.element=j,this.currentX=window.innerWidth/2,this.currentY=window.innerHeight/2,this.targetX=this.currentX,this.targetY=this.currentY,this.radius=this.calculateRadius(),window.addEventListener("resize",()=>{this.radius=this.calculateRadius()}),this.updateElementPosition()}calculateRadius(){return Math.min(window.innerWidth,window.innerHeight)*0.425}update(j,B,Q){this.targetX=j,this.targetY=B;let J=this.targetX-this.currentX,U=this.targetY-this.currentY,V=1-Math.pow(1-this.lagFactor,Q*60);this.currentX+=J*V,this.currentY+=U*V,this.updateElementPosition()}updateElementPosition(){this.element.style.left=`${this.currentX}px`,this.element.style.top=`${this.currentY}px`}getPosition(){return{x:this.currentX,y:this.currentY}}getRadius(){return this.radius}}class y{data;hoverTime=0;discoveryProgress=0;isAnimating=!1;animationTime=0;revealedConnections=0;currentConnectionProgress=0;lastRevealedConnections=0;onAnimationComplete=null;onConnectionRevealed=null;starActivationTimes=new Map;hoverTimeRequired=2;animationDuration=2.5;starFlashDuration=0.4;constructor(j){this.data={...j}}getData(){return this.data}getAnimationDuration(){return this.animationDuration}setOnAnimationComplete(j){this.onAnimationComplete=j}setOnConnectionRevealed(j){this.onConnectionRevealed=j}isDiscovered(){return this.data.discovered}addHoverTime(j){if(this.data.discovered||this.isAnimating)return!1;if(this.hoverTime+=j,this.discoveryProgress=Math.min(1,this.hoverTime/this.hoverTimeRequired),this.hoverTime>=this.hoverTimeRequired)return this.discover(),!0;return!1}resetHoverTime(){this.hoverTime=Math.max(0,this.hoverTime-0.1),this.discoveryProgress=this.hoverTime/this.hoverTimeRequired}discover(){this.data.discovered=!0,this.isAnimating=!0,this.animationTime=0,this.revealedConnections=0}render(j,B,Q,J,U){let V=this.data.centerX-B+J/2,Z=this.data.centerY-Q+U/2;if(Math.abs(V-J/2)>J||Math.abs(Z-U/2)>U)return;if(this.isAnimating){this.animationTime+=0.016;let K=this.animationTime/this.animationDuration*this.data.connections.length,M=Math.floor(K);if(this.currentConnectionProgress=K-M,M>this.revealedConnections&&this.onConnectionRevealed)for(let $=this.revealedConnections;$<M;$++){this.onConnectionRevealed($,this.data.connections.length);let q=this.data.connections[$];if(q){let[N,L]=q;if($===0&&N!==void 0)this.starActivationTimes.set(N,this.animationTime);if(L!==void 0)this.starActivationTimes.set(L,this.animationTime)}}if(this.revealedConnections=M,this.animationTime>=this.animationDuration){if(this.isAnimating=!1,this.revealedConnections=this.data.connections.length,this.currentConnectionProgress=0,this.onAnimationComplete)this.onAnimationComplete(),this.onAnimationComplete=null,this.onConnectionRevealed=null}}if(this.data.discovered)this.renderDiscovered(j,B,Q,J,U);else if(this.discoveryProgress>0)this.renderHint(j,B,Q,J,U)}renderHint(j,B,Q,J,U){let V=this.discoveryProgress*0.5;for(let Z of this.data.stars){let F=Z.x-B+J/2,K=Z.y-Q+U/2,M=Math.sin(Date.now()*0.005)*0.3+0.7,$=3+Z.brightness*2;j.beginPath(),j.arc(F,K,$*3,0,Math.PI*2);let q=j.createRadialGradient(F,K,0,F,K,$*3);q.addColorStop(0,`rgba(255, 217, 61, ${V*M*0.5})`),q.addColorStop(1,"rgba(255, 217, 61, 0)"),j.fillStyle=q,j.fill()}}renderDiscovered(j,B,Q,J,U){let V=this.isAnimating&&this.revealedConnections===this.data.connections.length,Z=0;if(V){let $=(this.animationTime-this.animationDuration*0.9)/(this.animationDuration*0.1);Z=Math.sin($*Math.PI)*0.8}let F=this.isAnimating?0.8:0.6,K=F+Z;j.strokeStyle=`rgba(255, 217, 61, ${K*0.7})`,j.lineWidth=1.5,j.lineCap="round";let M=this.isAnimating?this.revealedConnections:this.data.connections.length;for(let $=0;$<M;$++){let q=this.data.connections[$];if(!q)continue;let[N,L]=q,R=this.data.stars[N],_=this.data.stars[L];if(!R||!_)continue;let E=R.x-B+J/2,D=R.y-Q+U/2,z=_.x-B+J/2,k=_.y-Q+U/2;j.beginPath(),j.moveTo(E,D),j.lineTo(z,k),j.stroke()}if(this.isAnimating&&this.revealedConnections<this.data.connections.length){let $=this.data.connections[this.revealedConnections];if($){let[q,N]=$,L=this.data.stars[q],R=this.data.stars[N];if(L&&R){let _=L.x-B+J/2,E=L.y-Q+U/2,D=R.x-B+J/2,z=R.y-Q+U/2,k=this.currentConnectionProgress,O=_+(D-_)*k,P=E+(z-E)*k;j.beginPath(),j.moveTo(_,E),j.lineTo(O,P),j.stroke()}}}for(let $=0;$<this.data.stars.length;$++){let q=this.data.stars[$];if(!q)continue;let N=q.x-B+J/2,L=q.y-Q+U/2,R=this.starActivationTimes.get($),_=R!==void 0;if(this.isAnimating&&!_)continue;let E=3+q.brightness*3,D=F+Z,z=1;if(_&&this.isAnimating){let O=this.animationTime-R;if(O<this.starFlashDuration){let P=O/this.starFlashDuration,G=Math.sin(P*Math.PI);E*=1+G*0.3,z=1+G*0.5,D=Math.min(1,D+G*0.2)}}j.beginPath(),j.arc(N,L,E*4*z,0,Math.PI*2);let k=j.createRadialGradient(N,L,0,N,L,E*4*z);k.addColorStop(0,`rgba(255, 217, 61, ${D*0.6})`),k.addColorStop(0.5,`rgba(255, 217, 61, ${D*0.2})`),k.addColorStop(1,"rgba(255, 217, 61, 0)"),j.fillStyle=k,j.fill(),j.beginPath(),j.arc(N,L,E,0,Math.PI*2),j.fillStyle=`rgba(255, 250, 230, ${D})`,j.fill()}if(!this.isAnimating){let $=this.data.centerX-B+J/2,q=this.data.centerY-Q+U/2;j.font='14px "Cormorant Garamond", serif',j.fillStyle="rgba(200, 210, 230, 0.6)",j.textAlign="center",j.fillText(this.data.name,$,q+this.data.radius+30)}}}class S{listElement;countElement;discoveries=[];constructor(){this.listElement=document.getElementById("discoveries-list"),this.countElement=document.querySelector(".discovery-count")}addDiscovery(j){this.discoveries.push(j),this.updateCount(),this.addCard(j);let B=document.getElementById("discoveries-toggle");if(B)B.classList.add("pulse"),setTimeout(()=>B.classList.remove("pulse"),500)}updateCount(){if(this.countElement)this.countElement.textContent=String(this.discoveries.length)}addCard(j){if(!this.listElement)return;let B=document.createElement("div");B.className="discovery-card",B.innerHTML=`
      <h3>${j.name}</h3>
      <p>${j.description||j.latinName||""}</p>
    `,B.style.opacity="0",B.style.transform="translateY(-20px)",this.listElement.prepend(B),requestAnimationFrame(()=>{B.style.transition="all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",B.style.opacity="1",B.style.transform="translateY(0)"})}getDiscoveries(){return this.discoveries}}class f{audioContext=null;masterGain=null;ambientGain=null;ambientNodes=[];isAmbientPlaying=!1;initialized=!1;constructor(){this.initOnInteraction()}initOnInteraction(){let j=()=>{this.ensureInitialized(),document.removeEventListener("click",j),document.removeEventListener("keydown",j),document.removeEventListener("mousemove",j)};document.addEventListener("click",j),document.addEventListener("keydown",j),document.addEventListener("mousemove",j)}ensureInitialized(){if(this.initialized&&this.audioContext){if(this.audioContext.state==="suspended")this.audioContext.resume();return!0}try{return this.audioContext=new AudioContext,this.masterGain=this.audioContext.createGain(),this.masterGain.gain.value=0.3,this.masterGain.connect(this.audioContext.destination),this.ambientGain=this.audioContext.createGain(),this.ambientGain.gain.value=0,this.ambientGain.connect(this.masterGain),this.initialized=!0,console.log("\uD83D\uDD0A Audio initialized"),!0}catch(j){return console.warn("Audio initialization failed:",j),!1}}startAmbient(){if(this.isAmbientPlaying)return;if(!this.ensureInitialized()||!this.audioContext||!this.ambientGain)return;this.isAmbientPlaying=!0;let j=[55,82.5,110,165],B=this.audioContext.currentTime;for(let Q of j){let J=this.audioContext.createOscillator(),U=this.audioContext.createGain();J.type="sine",J.frequency.value=Q,U.gain.value=0.02,J.connect(U),U.connect(this.ambientGain),J.start(),this.ambientNodes.push(J)}this.ambientGain.gain.linearRampToValueAtTime(0.5,B+2)}stopAmbient(){if(!this.audioContext||!this.ambientGain)return;let j=this.audioContext.currentTime;this.ambientGain.gain.linearRampToValueAtTime(0,j+1),setTimeout(()=>{for(let B of this.ambientNodes)B.stop(),B.disconnect();this.ambientNodes=[],this.isAmbientPlaying=!1},1000)}playDiscoverySound(){if(!this.ensureInitialized()||!this.audioContext||!this.masterGain)return;let j=this.audioContext,B=j.currentTime,Q=[523.25,659.25,783.99,1046.5],J=0.15;for(let F=0;F<Q.length;F++){let K=Q[F];if(!K)continue;let M=j.createOscillator(),$=j.createGain();M.type="sine",M.frequency.value=K;let q=B+F*J;$.gain.setValueAtTime(0,q),$.gain.linearRampToValueAtTime(0.3,q+0.02),$.gain.exponentialRampToValueAtTime(0.01,q+J*2),M.connect($),$.connect(this.masterGain),M.start(q),M.stop(q+J*3)}let U=j.createOscillator(),V=j.createGain();U.type="sine",U.frequency.value=523.25;let Z=B+Q.length*J;V.gain.setValueAtTime(0,Z),V.gain.linearRampToValueAtTime(0.4,Z+0.1),V.gain.exponentialRampToValueAtTime(0.01,Z+1.5),U.connect(V),V.connect(this.masterGain),U.start(Z),U.stop(Z+2)}playStarConnectionSound(j,B){if(!this.ensureInitialized()||!this.audioContext||!this.masterGain)return;let Q=this.audioContext,J=Q.currentTime,V=400+j/B*400,Z=Q.createOscillator(),F=Q.createGain();Z.type="triangle",Z.frequency.value=V,F.gain.setValueAtTime(0,J),F.gain.linearRampToValueAtTime(0.15,J+0.01),F.gain.exponentialRampToValueAtTime(0.01,J+0.2),Z.connect(F),F.connect(this.masterGain),Z.start(J),Z.stop(J+0.3)}}var C=4000,b=2000,X=[{id:"orion",name:"Orion",latinName:"Orion",description:"The Hunter - One of the most recognizable constellations in the night sky.",centerX:800,centerY:600,radius:200,discovered:!1,stars:[{id:"betelgeuse",x:700,y:450,brightness:1},{id:"bellatrix",x:900,y:470,brightness:0.85},{id:"alnitak",x:770,y:600,brightness:0.8},{id:"alnilam",x:800,y:590,brightness:0.85},{id:"mintaka",x:830,y:580,brightness:0.8},{id:"saiph",x:720,y:750,brightness:0.75},{id:"rigel",x:880,y:770,brightness:0.95}],connections:[[0,1],[0,2],[1,4],[2,3],[3,4],[2,5],[4,6]]},{id:"ursa-major",name:"Ursa Major",latinName:"Ursa Major",description:"The Great Bear - Contains the famous Big Dipper asterism.",centerX:1800,centerY:400,radius:180,discovered:!1,stars:[{id:"dubhe",x:1650,y:320,brightness:0.9},{id:"merak",x:1680,y:420,brightness:0.85},{id:"phecda",x:1780,y:450,brightness:0.8},{id:"megrez",x:1820,y:380,brightness:0.7},{id:"alioth",x:1900,y:360,brightness:0.85},{id:"mizar",x:1970,y:340,brightness:0.9},{id:"alkaid",x:2050,y:380,brightness:0.88}],connections:[[0,1],[1,2],[2,3],[3,0],[3,4],[4,5],[5,6]]},{id:"cassiopeia",name:"Cassiopeia",latinName:"Cassiopeia",description:"The Queen - Easily recognized by its distinctive W shape.",centerX:2800,centerY:300,radius:140,discovered:!1,stars:[{id:"schedar",x:2650,y:280,brightness:0.9},{id:"caph",x:2720,y:350,brightness:0.85},{id:"gamma-cas",x:2800,y:260,brightness:0.95},{id:"ruchbah",x:2880,y:340,brightness:0.8},{id:"segin",x:2950,y:290,brightness:0.75}],connections:[[0,1],[1,2],[2,3],[3,4]]},{id:"cygnus",name:"Cygnus",latinName:"Cygnus",description:"The Swan - Also known as the Northern Cross.",centerX:1200,centerY:1200,radius:160,discovered:!1,stars:[{id:"deneb",x:1200,y:1050,brightness:1},{id:"sadr",x:1200,y:1180,brightness:0.85},{id:"gienah",x:1100,y:1220,brightness:0.75},{id:"delta-cyg",x:1300,y:1230,brightness:0.78},{id:"albireo",x:1200,y:1350,brightness:0.8}],connections:[[0,1],[1,4],[1,2],[1,3]]},{id:"lyra",name:"Lyra",latinName:"Lyra",description:"The Lyre - Home to Vega, one of the brightest stars.",centerX:2400,centerY:900,radius:100,discovered:!1,stars:[{id:"vega",x:2400,y:820,brightness:1},{id:"sulafat",x:2380,y:920,brightness:0.7},{id:"sheliak",x:2420,y:930,brightness:0.72},{id:"delta-lyr",x:2360,y:990,brightness:0.65},{id:"zeta-lyr",x:2440,y:980,brightness:0.68}],connections:[[0,1],[0,2],[1,2],[1,3],[2,4],[3,4]]},{id:"scorpius",name:"Scorpius",latinName:"Scorpius",description:"The Scorpion - Features the red supergiant Antares.",centerX:3200,centerY:1400,radius:200,discovered:!1,stars:[{id:"antares",x:3100,y:1300,brightness:1},{id:"graffias",x:3000,y:1200,brightness:0.75},{id:"dschubba",x:3050,y:1250,brightness:0.8},{id:"sigma-sco",x:3150,y:1380,brightness:0.7},{id:"tau-sco",x:3200,y:1450,brightness:0.72},{id:"sargas",x:3280,y:1520,brightness:0.78},{id:"shaula",x:3350,y:1580,brightness:0.85}],connections:[[1,2],[2,0],[0,3],[3,4],[4,5],[5,6]]}];class W{canvas;ctx;telescopeOverlay;state;starField;telescope;constellations;discoveriesTab;audioManager;lastFrameTime=0;animationFrameId=0;constructor(j,B){this.canvas=j,this.telescopeOverlay=B;let Q=j.getContext("2d");if(!Q)throw Error("Could not get 2D context");this.ctx=Q,this.state={running:!1,mouseX:window.innerWidth/2,mouseY:window.innerHeight/2,viewX:C/2,viewY:b/2,discoveredCount:0},this.starField=new A(C,b),this.telescope=new I(B),this.constellations=X.map((J)=>new y(J)),this.discoveriesTab=new S,this.audioManager=new f,this.setupEventListeners(),this.resizeCanvas()}setupEventListeners(){window.addEventListener("mousemove",(Q)=>{this.state.mouseX=Q.clientX,this.state.mouseY=Q.clientY}),window.addEventListener("resize",()=>this.resizeCanvas());let j=document.getElementById("discoveries-toggle"),B=document.getElementById("discoveries-panel");if(j&&B)j.addEventListener("click",()=>{B.classList.toggle("collapsed")})}resizeCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}start(){this.state.running=!0,this.lastFrameTime=performance.now(),this.audioManager.startAmbient(),this.gameLoop()}stop(){if(this.state.running=!1,this.animationFrameId)cancelAnimationFrame(this.animationFrameId);this.audioManager.stopAmbient()}gameLoop=()=>{if(!this.state.running)return;let j=performance.now(),B=(j-this.lastFrameTime)/1000;this.lastFrameTime=j,this.update(B),this.render(),this.animationFrameId=requestAnimationFrame(this.gameLoop)};update(j){this.telescope.update(this.state.mouseX,this.state.mouseY,j);let B=this.telescope.getPosition(),Q=(B.x-window.innerWidth/2)*0.5,J=(B.y-window.innerHeight/2)*0.5;this.state.viewX+=Q*j,this.state.viewY+=J*j;let U=400;this.state.viewX=Math.max(U,Math.min(C-U,this.state.viewX)),this.state.viewY=Math.max(U,Math.min(b-U,this.state.viewY)),this.checkConstellationDiscovery(j)}checkConstellationDiscovery(j){let B=this.telescope.getPosition(),Q=this.telescope.getRadius(),J=this.state.viewX+(B.x-window.innerWidth/2),U=this.state.viewY+(B.y-window.innerHeight/2);for(let V of this.constellations){if(V.isDiscovered())continue;let Z=V.getData();if(Math.hypot(J-Z.centerX,U-Z.centerY)<Z.radius+Q*0.3){if(V.addHoverTime(j))this.onConstellationDiscovered(V)}else V.resetHoverTime()}}onConstellationDiscovered(j){let B=j.getData();this.state.discoveredCount++,j.setOnConnectionRevealed((Q,J)=>{this.audioManager.playStarConnectionSound(Q,J)}),j.setOnAnimationComplete(()=>{this.audioManager.playDiscoverySound(),this.discoveriesTab.addDiscovery(B),this.showDiscoveryNotification(B.name)})}showDiscoveryNotification(j){let B=document.getElementById("discovery-notification"),Q=B?.querySelector(".constellation-name");if(B&&Q)B.classList.remove("hidden"),Q.textContent=j,requestAnimationFrame(()=>{B.classList.add("visible")}),setTimeout(()=>{B.classList.remove("visible"),setTimeout(()=>{B.classList.add("hidden")},500)},3000)}render(){let{ctx:j,canvas:B}=this,{viewX:Q,viewY:J}=this.state;j.fillStyle="#050510",j.fillRect(0,0,B.width,B.height);let U=this.telescope.getPosition(),V=this.telescope.getRadius();j.save(),j.beginPath(),j.arc(U.x,U.y,V,0,Math.PI*2),j.clip(),this.starField.render(j,Q,J,B.width,B.height,U);for(let Z of this.constellations)Z.render(j,Q,J,B.width,B.height);j.restore(),this.renderBackgroundStars()}renderBackgroundStars(){let{ctx:j,canvas:B}=this,Q=this.telescope.getPosition(),J=this.telescope.getRadius(),U=this.starField.getBackgroundStars();j.save(),j.beginPath(),j.rect(0,0,B.width,B.height),j.arc(Q.x,Q.y,J+30,0,Math.PI*2,!0),j.clip();for(let V of U){let Z=V.x/C*B.width,F=V.y/b*B.height;j.beginPath(),j.arc(Z,F,V.size*0.5,0,Math.PI*2),j.fillStyle=`rgba(200, 210, 255, ${V.brightness*0.3})`,j.fill()}j.restore()}}document.addEventListener("DOMContentLoaded",()=>{let j=document.getElementById("sky-canvas"),B=document.getElementById("telescope-overlay"),Q=document.getElementById("loading-screen"),J=document.querySelector(".loading-progress");if(!j||!B){console.error("Required elements not found");return}let U=new W(j,B),V=0,Z=setInterval(()=>{if(V+=Math.random()*15+5,V>=100)V=100,clearInterval(Z),setTimeout(()=>{Q.classList.add("hidden"),U.start()},500);J.style.width=`${V}%`},200)});

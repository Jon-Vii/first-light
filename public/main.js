class S{skyWidth;skyHeight;stars;backgroundStars;time=0;constructor(j,J){this.skyWidth=j,this.skyHeight=J,this.stars=this.generateStars(800),this.backgroundStars=this.generateBackgroundStars(200)}generateStars(j){let J=[],Q=12345,U=()=>{return Q=Q*1103515245+12345&2147483647,Q/2147483647};for(let Z=0;Z<j;Z++)J.push({x:U()*this.skyWidth,y:U()*this.skyHeight,size:U()*2+0.5,brightness:U()*0.5+0.5,twinkleOffset:U()*Math.PI*2});return J}generateBackgroundStars(j){let J=[],Q=67890,U=()=>{return Q=Q*1103515245+12345&2147483647,Q/2147483647};for(let Z=0;Z<j;Z++)J.push({x:U()*this.skyWidth,y:U()*this.skyHeight,size:U()*1.5+0.3,brightness:U()*0.6+0.2,twinkleOffset:U()*Math.PI*2});return J}getBackgroundStars(){return this.backgroundStars}render(j,J,Q,U,Z,$){this.time+=0.016;let B=j.createRadialGradient($.x,$.y,0,$.x,$.y,400);B.addColorStop(0,"#0f1020"),B.addColorStop(0.5,"#0a0a18"),B.addColorStop(1,"#050510"),j.fillStyle=B,j.fillRect(0,0,U,Z);for(let M of this.stars){let V=M.x-J+U/2,_=M.y-Q+Z/2;if(V<-50||V>U+50||_<-50||_>Z+50)continue;let E=Math.sin(this.time*2+M.twinkleOffset)*0.2+0.8,D=M.brightness*E;this.drawStar(j,V,_,M.size,D)}}drawStar(j,J,Q,U,Z){let $=j.createRadialGradient(J,Q,0,J,Q,U*4);$.addColorStop(0,`rgba(200, 210, 255, ${Z*0.3})`),$.addColorStop(0.5,`rgba(200, 210, 255, ${Z*0.1})`),$.addColorStop(1,"rgba(200, 210, 255, 0)"),j.beginPath(),j.arc(J,Q,U*4,0,Math.PI*2),j.fillStyle=$,j.fill(),j.beginPath(),j.arc(J,Q,U,0,Math.PI*2),j.fillStyle=`rgba(255, 255, 255, ${Z})`,j.fill()}}class T{element;radius;currentOffsetX=0;currentOffsetY=0;targetOffsetX=0;targetOffsetY=0;lagFactor=0.06;constructor(j){this.element=j,this.radius=this.calculateRadius(),window.addEventListener("resize",()=>{this.radius=this.calculateRadius(),this.updateElementPosition()}),this.updateElementPosition()}calculateRadius(){return Math.min(window.innerWidth,window.innerHeight)*0.36}update(j,J,Q){this.targetOffsetX=j-window.innerWidth/2,this.targetOffsetY=J-window.innerHeight/2;let U=1-Math.pow(1-this.lagFactor,Q*60),Z=this.targetOffsetX-this.currentOffsetX,$=this.targetOffsetY-this.currentOffsetY;this.currentOffsetX+=Z*U,this.currentOffsetY+=$*U}updateElementPosition(){let j=window.innerWidth/2,J=window.innerHeight/2;this.element.style.left=`${j}px`,this.element.style.top=`${J}px`}getPosition(){return{x:window.innerWidth/2,y:window.innerHeight/2}}getViewOffset(){return{x:this.currentOffsetX,y:this.currentOffsetY}}getRadius(){return this.radius}}class X{data;hoverTime=0;discoveryProgress=0;isAnimating=!1;animationTime=0;revealedConnections=0;currentConnectionProgress=0;lastRevealedConnections=0;onAnimationComplete=null;onConnectionRevealed=null;starActivationTimes=new Map;cosmicFlashTime=0;colors={coreWhite:"rgba(255, 255, 245, ",innerGold:"rgba(255, 225, 130, ",midAmber:"rgba(255, 190, 80, ",outerGlow:"rgba(220, 160, 60, ",cosmicHaze:"rgba(180, 140, 100, "};hoverTimeRequired=2;animationDuration=3.5;starFlashDuration=0.6;cosmicFlashDuration=1.2;scale=0.85;constructor(j){this.data={...j}}getScaledStarPosition(j){let J=j.x-this.data.centerX,Q=j.y-this.data.centerY;return{x:this.data.centerX+J*this.scale,y:this.data.centerY+Q*this.scale}}getData(){return this.data}getAnimationDuration(){return this.animationDuration}setOnAnimationComplete(j){this.onAnimationComplete=j}setOnConnectionRevealed(j){this.onConnectionRevealed=j}isDiscovered(){return this.data.discovered}getDiscoveryProgress(){return this.discoveryProgress}addHoverTime(j){if(this.data.discovered||this.isAnimating)return!1;if(this.hoverTime+=j,this.discoveryProgress=Math.min(1,this.hoverTime/this.hoverTimeRequired),this.hoverTime>=this.hoverTimeRequired)return this.discover(),!0;return!1}resetHoverTime(){this.hoverTime=0,this.discoveryProgress=0}discover(){this.data.discovered=!0,this.isAnimating=!0,this.animationTime=0,this.revealedConnections=0,this.starActivationTimes.clear(),this.cosmicFlashTime=0}cancelDiscovery(){if(!this.isAnimating)return;this.data.discovered=!1,this.isAnimating=!1,this.animationTime=0,this.revealedConnections=0,this.currentConnectionProgress=0,this.starActivationTimes.clear(),this.cosmicFlashTime=0,this.hoverTime=0,this.discoveryProgress=0,this.onAnimationComplete=null,this.onConnectionRevealed=null}isAnimatingDiscovery(){return this.isAnimating}update(j,J=!0){if(!this.isAnimating)return;if(!J)return;let Q=this.animationTime===0;if(this.animationTime+=j,Q&&this.data.connections.length>0){let B=this.data.connections[0];if(B){let[M]=B;if(M!==void 0){if(this.starActivationTimes.set(M,this.animationTime),this.onConnectionRevealed)this.onConnectionRevealed(-1,this.data.connections.length)}}}let Z=Math.min(1,this.animationTime/this.animationDuration)*this.data.connections.length,$=Math.floor(Z);if(this.currentConnectionProgress=Z-$,$>this.revealedConnections)for(let B=this.revealedConnections;B<$;B++){if(this.onConnectionRevealed)this.onConnectionRevealed(B,this.data.connections.length);let M=this.data.connections[B];if(M){let[,V]=M;if(V!==void 0&&!this.starActivationTimes.has(V))this.starActivationTimes.set(V,this.animationTime)}}if(this.revealedConnections=$,this.animationTime>=this.animationDuration){if(this.isAnimating=!1,this.revealedConnections=this.data.connections.length,this.currentConnectionProgress=0,this.onAnimationComplete)this.onAnimationComplete(),this.onAnimationComplete=null,this.onConnectionRevealed=null}}render(j,J,Q,U,Z){let $=this.data.centerX-J+U/2,B=this.data.centerY-Q+Z/2;if(Math.abs($-U/2)>U||Math.abs(B-Z/2)>Z)return;if(this.data.discovered)this.renderDiscovered(j,J,Q,U,Z);else if(this.discoveryProgress>0)this.renderHint(j,J,Q,U,Z)}renderHint(j,J,Q,U,Z){let $=this.discoveryProgress*0.5;for(let B of this.data.stars){let M=this.getScaledStarPosition(B),V=M.x-J+U/2,_=M.y-Q+Z/2,E=Math.sin(Date.now()*0.005)*0.3+0.7,D=3+B.brightness*2;j.beginPath(),j.arc(V,_,D*3,0,Math.PI*2);let K=j.createRadialGradient(V,_,0,V,_,D*3);K.addColorStop(0,`rgba(255, 217, 61, ${$*E*0.5})`),K.addColorStop(1,"rgba(255, 217, 61, 0)"),j.fillStyle=K,j.fill()}}renderDiscovered(j,J,Q,U,Z){let $=this.data.centerX-J+U/2,B=this.data.centerY-Q+Z/2;if(this.isAnimating&&this.revealedConnections===this.data.connections.length&&this.cosmicFlashTime===0)this.cosmicFlashTime=this.animationTime;let V=0;if(this.cosmicFlashTime>0){let K=this.animationTime-this.cosmicFlashTime;if(K<this.cosmicFlashDuration){let N=K/this.cosmicFlashDuration;V=Math.sin(N*Math.PI)}}let _=this.isAnimating?0.8:0.6,E=_+V*0.4;if(V>0){let K=V*350,N=j.createRadialGradient($,B,K*0.7,$,B,K);N.addColorStop(0,"rgba(255, 220, 100, 0)"),N.addColorStop(0.5,`rgba(255, 180, 50, ${V*0.4})`),N.addColorStop(1,"rgba(255, 140, 30, 0)"),j.beginPath(),j.arc($,B,K,0,Math.PI*2),j.fillStyle=N,j.fill();let q=j.createRadialGradient($,B,0,$,B,180);q.addColorStop(0,`rgba(255, 250, 220, ${V*0.5})`),q.addColorStop(0.4,`rgba(255, 200, 100, ${V*0.3})`),q.addColorStop(1,"rgba(255, 160, 50, 0)"),j.beginPath(),j.arc($,B,180,0,Math.PI*2),j.fillStyle=q,j.fill()}j.lineCap="round";let D=this.isAnimating?this.revealedConnections:this.data.connections.length;for(let K=0;K<D;K++){let N=this.data.connections[K];if(!N)continue;let[q,L]=N,R=this.data.stars[q],P=this.data.stars[L];if(!R||!P)continue;let C=this.getScaledStarPosition(R),F=this.getScaledStarPosition(P),k=C.x-J+U/2,z=C.y-Q+Z/2,A=F.x-J+U/2,W=F.y-Q+Z/2;this.drawGlowingLine(j,k,z,A,W,E)}if(this.isAnimating&&this.revealedConnections<this.data.connections.length){let K=this.data.connections[this.revealedConnections];if(K){let[N,q]=K,L=this.data.stars[N],R=this.data.stars[q];if(L&&R){let P=this.getScaledStarPosition(L),C=this.getScaledStarPosition(R),F=P.x-J+U/2,k=P.y-Q+Z/2,z=C.x-J+U/2,A=C.y-Q+Z/2,W=this.currentConnectionProgress,O=F+(z-F)*W,b=k+(A-k)*W;this.drawGlowingLine(j,F,k,O,b,E),this.drawSparkHead(j,O,b)}}}for(let K=0;K<this.data.stars.length;K++){let N=this.data.stars[K];if(!N)continue;let q=this.getScaledStarPosition(N),L=q.x-J+U/2,R=q.y-Q+Z/2,P=this.starActivationTimes.get(K),C=P!==void 0,F=3+N.brightness*3,k=_+V*0.3,z=0;if(this.isAnimating&&!C){let W=3+N.brightness*2,O=Math.sin(Date.now()*0.005)*0.3+0.7;j.beginPath(),j.arc(L,R,W*3,0,Math.PI*2);let b=j.createRadialGradient(L,R,0,L,R,W*3);b.addColorStop(0,`rgba(255, 217, 61, ${0.35*O*0.5})`),b.addColorStop(1,"rgba(255, 217, 61, 0)"),j.fillStyle=b,j.fill();continue}if(this.isAnimating&&C){let A=this.animationTime-P;if(A<this.starFlashDuration)z=Math.sin(A/this.starFlashDuration*Math.PI),F*=1+z*0.4,k=Math.min(1,k+z*0.3)}this.renderCosmicStar(j,L,R,F,k,C,z)}if(!this.isAnimating)j.font='16px "Cormorant Garamond", serif',j.fillStyle="rgba(255, 220, 180, 0.7)",j.textAlign="center",j.shadowColor="rgba(255, 180, 80, 0.5)",j.shadowBlur=10,j.fillText(this.data.name,$,B+this.data.radius+35),j.shadowBlur=0}drawGlowingLine(j,J,Q,U,Z,$){j.lineCap="round",j.beginPath(),j.moveTo(J,Q),j.lineTo(U,Z),j.strokeStyle=`${this.colors.outerGlow}${$*0.2})`,j.lineWidth=12,j.stroke(),j.beginPath(),j.moveTo(J,Q),j.lineTo(U,Z),j.strokeStyle=`${this.colors.midAmber}${$*0.4})`,j.lineWidth=6,j.stroke(),j.beginPath(),j.moveTo(J,Q),j.lineTo(U,Z),j.strokeStyle=`${this.colors.innerGold}${$*0.7})`,j.lineWidth=3,j.stroke(),j.beginPath(),j.moveTo(J,Q),j.lineTo(U,Z),j.strokeStyle=`${this.colors.coreWhite}${$*0.9})`,j.lineWidth=1.5,j.stroke()}drawSparkHead(j,J,Q){let Z=Date.now()*0.01,$=0.85+Math.sin(Z)*0.15,B=j.createRadialGradient(J,Q,0,J,Q,25);B.addColorStop(0,`rgba(255, 160, 60, ${0.8*$})`),B.addColorStop(0.5,`rgba(220, 100, 40, ${0.4*$})`),B.addColorStop(1,"rgba(180, 80, 60, 0)"),j.beginPath(),j.arc(J,Q,25,0,Math.PI*2),j.fillStyle=B,j.fill();let M=j.createRadialGradient(J,Q,0,J,Q,10);M.addColorStop(0,`rgba(255, 255, 250, ${$})`),M.addColorStop(0.4,`rgba(255, 230, 150, ${0.9*$})`),M.addColorStop(0.7,`rgba(255, 180, 80, ${0.5*$})`),M.addColorStop(1,"rgba(255, 140, 50, 0)"),j.beginPath(),j.arc(J,Q,10,0,Math.PI*2),j.fillStyle=M,j.fill(),j.beginPath(),j.arc(J,Q,2.5,0,Math.PI*2),j.fillStyle=`rgba(255, 255, 255, ${$})`,j.fill()}renderCosmicStar(j,J,Q,U,Z,$,B){let M=$?1+B*0.6:0.5;if($){let K=U*6*M,N=j.createRadialGradient(J,Q,U*2,J,Q,K);N.addColorStop(0,`${this.colors.outerGlow}${Z*0.15})`),N.addColorStop(0.6,`${this.colors.cosmicHaze}${Z*0.08})`),N.addColorStop(1,"rgba(180, 140, 100, 0)"),j.beginPath(),j.arc(J,Q,K,0,Math.PI*2),j.fillStyle=N,j.fill()}let V=U*4*M,_=j.createRadialGradient(J,Q,U,J,Q,V);_.addColorStop(0,`${this.colors.midAmber}${Z*0.4})`),_.addColorStop(0.6,`${this.colors.outerGlow}${Z*0.2})`),_.addColorStop(1,"rgba(220, 160, 60, 0)"),j.beginPath(),j.arc(J,Q,V,0,Math.PI*2),j.fillStyle=_,j.fill();let E=U*2.5*M,D=j.createRadialGradient(J,Q,0,J,Q,E);D.addColorStop(0,`${this.colors.innerGold}${Z*0.7})`),D.addColorStop(0.5,`${this.colors.midAmber}${Z*0.4})`),D.addColorStop(1,"rgba(255, 190, 80, 0)"),j.beginPath(),j.arc(J,Q,E,0,Math.PI*2),j.fillStyle=D,j.fill(),j.beginPath(),j.arc(J,Q,U*0.8,0,Math.PI*2),j.fillStyle=`${this.colors.coreWhite}${Math.min(1,Z*1.1)})`,j.fill()}}var f=4000,I=2000,H=[{id:"orion",name:"Orion",latinName:"Orion",description:"The Hunter - One of the most recognizable constellations in the night sky.",centerX:800,centerY:600,radius:200,discovered:!1,stars:[{id:"betelgeuse",x:700,y:450,brightness:1},{id:"bellatrix",x:900,y:470,brightness:0.85},{id:"alnitak",x:770,y:600,brightness:0.8},{id:"alnilam",x:800,y:590,brightness:0.85},{id:"mintaka",x:830,y:580,brightness:0.8},{id:"saiph",x:720,y:750,brightness:0.75},{id:"rigel",x:880,y:770,brightness:0.95}],connections:[[0,1],[0,2],[1,4],[2,3],[3,4],[2,5],[4,6]]},{id:"ursa-major",name:"Ursa Major",latinName:"Ursa Major",description:"The Great Bear - Contains the famous Big Dipper asterism.",centerX:1800,centerY:400,radius:180,discovered:!1,stars:[{id:"dubhe",x:1650,y:320,brightness:0.9},{id:"merak",x:1680,y:420,brightness:0.85},{id:"phecda",x:1780,y:450,brightness:0.8},{id:"megrez",x:1820,y:380,brightness:0.7},{id:"alioth",x:1900,y:360,brightness:0.85},{id:"mizar",x:1970,y:340,brightness:0.9},{id:"alkaid",x:2050,y:380,brightness:0.88}],connections:[[0,1],[1,2],[2,3],[3,0],[3,4],[4,5],[5,6]]},{id:"cassiopeia",name:"Cassiopeia",latinName:"Cassiopeia",description:"The Queen - Easily recognized by its distinctive W shape.",centerX:2800,centerY:300,radius:140,discovered:!1,stars:[{id:"schedar",x:2650,y:280,brightness:0.9},{id:"caph",x:2720,y:350,brightness:0.85},{id:"gamma-cas",x:2800,y:260,brightness:0.95},{id:"ruchbah",x:2880,y:340,brightness:0.8},{id:"segin",x:2950,y:290,brightness:0.75}],connections:[[0,1],[1,2],[2,3],[3,4]]},{id:"cygnus",name:"Cygnus",latinName:"Cygnus",description:"The Swan - Also known as the Northern Cross.",centerX:1200,centerY:1200,radius:160,discovered:!1,stars:[{id:"deneb",x:1200,y:1050,brightness:1},{id:"sadr",x:1200,y:1180,brightness:0.85},{id:"gienah",x:1100,y:1220,brightness:0.75},{id:"delta-cyg",x:1300,y:1230,brightness:0.78},{id:"albireo",x:1200,y:1350,brightness:0.8}],connections:[[0,1],[1,4],[1,2],[1,3]]},{id:"lyra",name:"Lyra",latinName:"Lyra",description:"The Lyre - Home to Vega, one of the brightest stars.",centerX:2400,centerY:900,radius:100,discovered:!1,stars:[{id:"vega",x:2400,y:820,brightness:1},{id:"sulafat",x:2380,y:920,brightness:0.7},{id:"sheliak",x:2420,y:930,brightness:0.72},{id:"delta-lyr",x:2360,y:990,brightness:0.65},{id:"zeta-lyr",x:2440,y:980,brightness:0.68}],connections:[[0,1],[0,2],[1,2],[1,3],[2,4],[3,4]]},{id:"scorpius",name:"Scorpius",latinName:"Scorpius",description:"The Scorpion - Features the red supergiant Antares.",centerX:3200,centerY:1400,radius:200,discovered:!1,stars:[{id:"antares",x:3100,y:1300,brightness:1},{id:"graffias",x:3000,y:1200,brightness:0.75},{id:"dschubba",x:3050,y:1250,brightness:0.8},{id:"sigma-sco",x:3150,y:1380,brightness:0.7},{id:"tau-sco",x:3200,y:1450,brightness:0.72},{id:"sargas",x:3280,y:1520,brightness:0.78},{id:"shaula",x:3350,y:1580,brightness:0.85}],connections:[[1,2],[2,0],[0,3],[3,4],[4,5],[5,6]]}];class Y{listElement;countElement;discoveries=[];totalConstellations=0;constructor(){this.listElement=document.getElementById("discoveries-list"),this.countElement=document.querySelector(".discovery-count"),this.totalConstellations=H.length,this.updateCount()}addDiscovery(j){if(this.discoveries.some((Q)=>Q.id===j.id))return;this.discoveries.push(j),this.updateCount(),this.addCard(j);let J=document.getElementById("discoveries-toggle");if(J)J.classList.add("pulse"),setTimeout(()=>J.classList.remove("pulse"),500)}updateCount(){if(this.countElement)this.countElement.textContent=`${this.discoveries.length}/${this.totalConstellations}`}addCard(j){if(!this.listElement)return;let J=document.createElement("div");J.className="discovery-card";let Q=this.generateConstellationSVG(j);J.innerHTML=`
      <div class="discovery-icon">
        ${Q}
      </div>
      <div class="discovery-info">
        <h3>${j.name}</h3>
        <p>${j.description||j.latinName||""}</p>
      </div>
    `,J.style.opacity="0",J.style.transform="translateY(-20px)",this.listElement.prepend(J),requestAnimationFrame(()=>{J.style.transition="all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",J.style.opacity="1",J.style.transform="translateY(0)"})}generateConstellationSVG(j){let J=Math.min(...j.stars.map((D)=>D.x)),Q=Math.max(...j.stars.map((D)=>D.x)),U=Math.min(...j.stars.map((D)=>D.y)),Z=Math.max(...j.stars.map((D)=>D.y)),$=50,B=Q-J+100,M=Z-U+100,V=(D)=>(D-J+50)/B*100,_=(D)=>(D-U+50)/M*100,E='<svg viewBox="0 0 100 100" class="constellation-miniature">';return j.connections.forEach(([D,K])=>{let N=j.stars[D],q=j.stars[K];if(N&&q)E+=`<line 
          x1="${V(N.x)}" y1="${_(N.y)}" 
          x2="${V(q.x)}" y2="${_(q.y)}" 
          stroke="var(--color-star-gold)" 
          stroke-width="2" 
          stroke-linecap="round"
          opacity="0.8" />`}),j.stars.forEach((D)=>{let K=V(D.x),N=_(D.y),q=2+D.brightness*2.5;E+=`<circle cx="${K}" cy="${N}" r="${q}" fill="white" />`}),E+="</svg>",E}getDiscoveries(){return this.discoveries}}class G{audioContext=null;masterGain=null;ambientGain=null;ambientNodes=[];isAmbientPlaying=!1;initialized=!1;buildUpOscillators=[];buildUpGains=[];isBuildUpPlaying=!1;pentatonicScale=[523.25,587.33,659.25,783.99,880,1046.5];constructor(){this.initOnInteraction()}initOnInteraction(){let j=()=>{this.ensureInitialized(),document.removeEventListener("click",j),document.removeEventListener("keydown",j),document.removeEventListener("mousemove",j)};document.addEventListener("click",j),document.addEventListener("keydown",j),document.addEventListener("mousemove",j)}ensureInitialized(){if(this.initialized&&this.audioContext){if(this.audioContext.state==="suspended")this.audioContext.resume();return!0}try{if(this.audioContext=new AudioContext,this.masterGain=this.audioContext.createGain(),this.masterGain.gain.value=0.3,this.masterGain.connect(this.audioContext.destination),this.ambientGain=this.audioContext.createGain(),this.ambientGain.gain.value=0,this.ambientGain.connect(this.masterGain),this.initialized=!0,console.log("\uD83D\uDD0A Audio initialized, state:",this.audioContext.state),this.audioContext.state==="suspended")this.audioContext.resume();return!0}catch(j){return console.warn("Audio initialization failed:",j),!1}}startAmbient(){if(this.isAmbientPlaying)return;if(!this.ensureInitialized()||!this.audioContext||!this.ambientGain)return;this.isAmbientPlaying=!0;let j=[55,82.5,110,165],J=this.audioContext.currentTime;for(let Q of j){let U=this.audioContext.createOscillator(),Z=this.audioContext.createGain();U.type="sine",U.frequency.value=Q,Z.gain.value=0.02,U.connect(Z),Z.connect(this.ambientGain),U.start(),this.ambientNodes.push(U)}this.ambientGain.gain.linearRampToValueAtTime(0.5,J+2)}stopAmbient(){if(!this.audioContext||!this.ambientGain)return;let j=this.audioContext.currentTime;this.ambientGain.gain.linearRampToValueAtTime(0,j+1),setTimeout(()=>{for(let J of this.ambientNodes)J.stop(),J.disconnect();this.ambientNodes=[],this.isAmbientPlaying=!1},1000)}playDiscoverySound(){this.playCosmicFlash()}playCosmicFlash(){if(!this.ensureInitialized()||!this.audioContext||!this.masterGain)return;let j=this.audioContext,J=j.currentTime,Q=j.createOscillator(),U=j.createGain();Q.type="sine",Q.frequency.setValueAtTime(50,J),Q.frequency.exponentialRampToValueAtTime(30,J+0.3),U.gain.setValueAtTime(0,J),U.gain.linearRampToValueAtTime(0.5,J+0.02),U.gain.exponentialRampToValueAtTime(0.01,J+0.5),Q.connect(U),U.connect(this.masterGain),Q.start(J),Q.stop(J+0.6);let Z=j.sampleRate*0.8,$=j.createBuffer(1,Z,j.sampleRate),B=$.getChannelData(0);for(let D=0;D<Z;D++)B[D]=Math.random()*2-1;let M=j.createBufferSource();M.buffer=$;let V=j.createBiquadFilter();V.type="bandpass",V.frequency.setValueAtTime(200,J),V.frequency.exponentialRampToValueAtTime(3000,J+0.4),V.Q.value=1;let _=j.createGain();_.gain.setValueAtTime(0,J),_.gain.linearRampToValueAtTime(0.15,J+0.1),_.gain.linearRampToValueAtTime(0.2,J+0.3),_.gain.exponentialRampToValueAtTime(0.01,J+0.7),M.connect(V),V.connect(_),_.connect(this.masterGain),M.start(J),M.stop(J+0.8);let E=[1046.5,1318.5,1568,2093];for(let D=0;D<E.length;D++){let K=E[D];if(!K)continue;let N=j.createOscillator(),q=j.createGain();N.type="sine",N.frequency.value=K;let L=J+0.1+D*0.05;q.gain.setValueAtTime(0,L),q.gain.linearRampToValueAtTime(0.12,L+0.02),q.gain.exponentialRampToValueAtTime(0.01,L+1.2),N.connect(q),q.connect(this.masterGain),N.start(L),N.stop(L+1.5)}}playStarConnectionSound(j,J){if(!this.ensureInitialized()||!this.audioContext||!this.masterGain)return;let Q=this.audioContext,U=Q.currentTime,Z=j%this.pentatonicScale.length,$=this.pentatonicScale[Z]||523.25,B=3,M=Q.createOscillator(),V=Q.createGain();M.type="sine",M.frequency.value=$-B;let _=Q.createOscillator(),E=Q.createGain();_.type="sine",_.frequency.value=$+B;let D=Q.createOscillator(),K=Q.createGain();D.type="sine",D.frequency.value=$*2;let N=0.015,q=0.6,L=0.12,R=0.04;for(let[P,C]of[[M,V],[_,E]])C.gain.setValueAtTime(0,U),C.gain.linearRampToValueAtTime(L,U+N),C.gain.exponentialRampToValueAtTime(0.001,U+q),P.connect(C),C.connect(this.masterGain),P.start(U),P.stop(U+q+0.1);K.gain.setValueAtTime(0,U),K.gain.linearRampToValueAtTime(R,U+N*2),K.gain.exponentialRampToValueAtTime(0.001,U+q*0.8),D.connect(K),K.connect(this.masterGain),D.start(U),D.stop(U+q)}playDiscoveryBuildUp(j){if(!this.ensureInitialized()||!this.audioContext||!this.masterGain)return;let J=this.audioContext;if(!this.isBuildUpPlaying){this.isBuildUpPlaying=!0;let U=J.createOscillator(),Z=J.createGain();U.type="sine",U.frequency.value=80,Z.gain.value=0,U.connect(Z),Z.connect(this.masterGain),U.start(),this.buildUpOscillators.push(U),this.buildUpGains.push(Z);let $=J.createOscillator(),B=J.createGain();$.type="sine",$.frequency.value=220,B.gain.value=0,$.connect(B),B.connect(this.masterGain),$.start(),this.buildUpOscillators.push($),this.buildUpGains.push(B);let M=J.createOscillator(),V=J.createGain();M.type="sine",M.frequency.value=440,V.gain.value=0,M.connect(V),V.connect(this.masterGain),M.start(),this.buildUpOscillators.push(M),this.buildUpGains.push(V)}let Q=J.currentTime;if(this.buildUpGains[0])this.buildUpGains[0].gain.setTargetAtTime(0.03*j,Q,0.1);if(this.buildUpOscillators[1]&&this.buildUpGains[1]){let U=220+j*180;this.buildUpOscillators[1].frequency.setTargetAtTime(U,Q,0.1),this.buildUpGains[1].gain.setTargetAtTime(0.04*j,Q,0.1)}if(this.buildUpOscillators[2]&&this.buildUpGains[2]){let U=Math.max(0,(j-0.5)*2),Z=440+U*200;this.buildUpOscillators[2].frequency.setTargetAtTime(Z,Q,0.1),this.buildUpGains[2].gain.setTargetAtTime(0.025*U,Q,0.1)}}stopDiscoveryBuildUp(){if(!this.isBuildUpPlaying||!this.audioContext)return;let j=this.audioContext.currentTime;for(let J of this.buildUpGains)J.gain.setTargetAtTime(0,j,0.15);setTimeout(()=>{for(let J of this.buildUpOscillators)try{J.stop(),J.disconnect()}catch(Q){}this.buildUpOscillators=[],this.buildUpGains=[],this.isBuildUpPlaying=!1},300)}}class u{canvas;ctx;telescopeOverlay;state;starField;telescope;constellations;discoveriesTab;audioManager;lastFrameTime=0;animationFrameId=0;constructor(j,J){this.canvas=j,this.telescopeOverlay=J;let Q=j.getContext("2d");if(!Q)throw Error("Could not get 2D context");this.ctx=Q,this.state={running:!1,mouseX:window.innerWidth/2,mouseY:window.innerHeight/2,viewX:f/2,viewY:I/2,discoveredCount:0},this.starField=new S(f,I),this.telescope=new T(J),this.constellations=H.map((U)=>new X(U)),this.discoveriesTab=new Y,this.audioManager=new G,this.setupEventListeners(),this.resizeCanvas()}setupEventListeners(){window.addEventListener("mousemove",(Q)=>{this.state.mouseX=Q.clientX,this.state.mouseY=Q.clientY}),window.addEventListener("resize",()=>this.resizeCanvas());let j=document.getElementById("discoveries-toggle"),J=document.getElementById("discoveries-panel");if(j&&J)j.addEventListener("click",()=>{J.classList.toggle("collapsed")})}resizeCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}start(){this.state.running=!0,this.lastFrameTime=performance.now(),this.audioManager.startAmbient(),this.gameLoop()}stop(){if(this.state.running=!1,this.animationFrameId)cancelAnimationFrame(this.animationFrameId);this.audioManager.stopAmbient()}gameLoop=()=>{if(!this.state.running)return;let j=performance.now(),J=(j-this.lastFrameTime)/1000;this.lastFrameTime=j,this.update(J),this.render(),this.animationFrameId=requestAnimationFrame(this.gameLoop)};update(j){this.telescope.update(this.state.mouseX,this.state.mouseY,j);let J=this.telescope.getViewOffset(),Q=J.x*0.5,U=J.y*0.5;this.state.viewX+=Q*j,this.state.viewY+=U*j;let Z=400;this.state.viewX=Math.max(Z,Math.min(f-Z,this.state.viewX)),this.state.viewY=Math.max(Z,Math.min(I-Z,this.state.viewY)),this.checkConstellationDiscovery(j);let $=this.state.viewX,B=this.state.viewY,M=this.telescope.getRadius();for(let V of this.constellations){let _=V.getData(),D=Math.hypot($-_.centerX,B-_.centerY)<_.radius+M*0.5;if(!D&&V.isAnimatingDiscovery()){if(V.cancelDiscovery(),this.state.discoveredCount>0)this.state.discoveredCount--}V.update(j,D)}}checkConstellationDiscovery(j){let J=this.telescope.getPosition(),Q=this.telescope.getRadius(),U=this.state.viewX,Z=this.state.viewY,$=!1;for(let B of this.constellations){if(B.isDiscovered())continue;let M=B.getData();if(Math.hypot(U-M.centerX,Z-M.centerY)<M.radius+Q*0.3){$=!0;let _=B.addHoverTime(j),E=B.getDiscoveryProgress();if(this.audioManager.playDiscoveryBuildUp(E),_)this.audioManager.stopDiscoveryBuildUp(),this.onConstellationDiscovered(B)}else B.resetHoverTime()}if(!$)this.audioManager.stopDiscoveryBuildUp()}onConstellationDiscovered(j){let J=j.getData();this.state.discoveredCount++,j.setOnConnectionRevealed((Q,U)=>{this.audioManager.playStarConnectionSound(Q,U)}),j.setOnAnimationComplete(()=>{this.audioManager.playDiscoverySound(),this.discoveriesTab.addDiscovery(J),this.showDiscoveryNotification(J.name)})}showDiscoveryNotification(j){let J=document.getElementById("discovery-notification"),Q=J?.querySelector(".constellation-name");if(J&&Q)J.classList.remove("hidden"),Q.textContent=j,requestAnimationFrame(()=>{J.classList.add("visible")}),setTimeout(()=>{J.classList.remove("visible"),setTimeout(()=>{J.classList.add("hidden")},500)},3000)}render(){let{ctx:j,canvas:J}=this,{viewX:Q,viewY:U}=this.state;j.fillStyle="#050510",j.fillRect(0,0,J.width,J.height);let Z=this.telescope.getPosition(),$=this.telescope.getRadius();j.save(),j.beginPath(),j.arc(Z.x,Z.y,$,0,Math.PI*2),j.clip(),this.starField.render(j,Q,U,J.width,J.height,Z);for(let B of this.constellations)B.render(j,Q,U,J.width,J.height);j.restore(),this.renderBackgroundStars()}renderBackgroundStars(){let{ctx:j,canvas:J}=this,Q=this.telescope.getPosition(),U=this.telescope.getRadius(),Z=this.starField.getBackgroundStars();j.save(),j.beginPath(),j.rect(0,0,J.width,J.height),j.arc(Q.x,Q.y,U+30,0,Math.PI*2,!0),j.clip();for(let $ of Z){let B=$.x/f*J.width,M=$.y/I*J.height;j.beginPath(),j.arc(B,M,$.size*0.5,0,Math.PI*2),j.fillStyle=`rgba(200, 210, 255, ${$.brightness*0.3})`,j.fill()}j.restore()}}document.addEventListener("DOMContentLoaded",()=>{let j=document.getElementById("sky-canvas"),J=document.getElementById("telescope-overlay"),Q=document.getElementById("start-screen"),U=document.getElementById("start-button");if(!j||!J){console.error("Required elements not found");return}let Z=new u(j,J);U?.addEventListener("click",()=>{Q.classList.add("hidden"),Z.start()})});

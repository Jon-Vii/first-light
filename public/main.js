class A{skyWidth;skyHeight;stars;backgroundStars;time=0;constructor(j,J){this.skyWidth=j,this.skyHeight=J,this.stars=this.generateStars(800),this.backgroundStars=this.generateBackgroundStars(200)}generateStars(j){let J=[],U=12345,Q=()=>{return U=U*1103515245+12345&2147483647,U/2147483647};for(let V=0;V<j;V++)J.push({x:Q()*this.skyWidth,y:Q()*this.skyHeight,size:Q()*2+0.5,brightness:Q()*0.5+0.5,twinkleOffset:Q()*Math.PI*2});return J}generateBackgroundStars(j){let J=[],U=67890,Q=()=>{return U=U*1103515245+12345&2147483647,U/2147483647};for(let V=0;V<j;V++)J.push({x:Q()*this.skyWidth,y:Q()*this.skyHeight,size:Q()*1.5+0.3,brightness:Q()*0.6+0.2,twinkleOffset:Q()*Math.PI*2});return J}getBackgroundStars(){return this.backgroundStars}render(j,J,U,Q,V,Z){this.time+=0.016;let $=j.createRadialGradient(Z.x,Z.y,0,Z.x,Z.y,400);$.addColorStop(0,"#0f1020"),$.addColorStop(0.5,"#0a0a18"),$.addColorStop(1,"#050510"),j.fillStyle=$,j.fillRect(0,0,Q,V);for(let B of this.stars){let M=B.x-J+Q/2,K=B.y-U+V/2;if(M<-50||M>Q+50||K<-50||K>V+50)continue;let q=Math.sin(this.time*2+B.twinkleOffset)*0.2+0.8,F=B.brightness*q;this.drawStar(j,M,K,B.size,F)}}drawStar(j,J,U,Q,V){let Z=j.createRadialGradient(J,U,0,J,U,Q*4);Z.addColorStop(0,`rgba(200, 210, 255, ${V*0.3})`),Z.addColorStop(0.5,`rgba(200, 210, 255, ${V*0.1})`),Z.addColorStop(1,"rgba(200, 210, 255, 0)"),j.beginPath(),j.arc(J,U,Q*4,0,Math.PI*2),j.fillStyle=Z,j.fill(),j.beginPath(),j.arc(J,U,Q,0,Math.PI*2),j.fillStyle=`rgba(255, 255, 255, ${V})`,j.fill()}}class I{element;currentX;currentY;targetX;targetY;radius;lagFactor=0.08;maxLag=50;constructor(j){this.element=j,this.currentX=window.innerWidth/2,this.currentY=window.innerHeight/2,this.targetX=this.currentX,this.targetY=this.currentY,this.radius=this.calculateRadius(),window.addEventListener("resize",()=>{this.radius=this.calculateRadius()}),this.updateElementPosition()}calculateRadius(){return Math.min(window.innerWidth,window.innerHeight)*0.425}update(j,J,U){this.targetX=j,this.targetY=J;let Q=this.targetX-this.currentX,V=this.targetY-this.currentY,Z=1-Math.pow(1-this.lagFactor,U*60);this.currentX+=Q*Z,this.currentY+=V*Z,this.updateElementPosition()}updateElementPosition(){this.element.style.left=`${this.currentX}px`,this.element.style.top=`${this.currentY}px`}getPosition(){return{x:this.currentX,y:this.currentY}}getRadius(){return this.radius}}class y{data;hoverTime=0;discoveryProgress=0;isAnimating=!1;animationTime=0;revealedConnections=0;currentConnectionProgress=0;lastRevealedConnections=0;onAnimationComplete=null;onConnectionRevealed=null;starActivationTimes=new Map;hoverTimeRequired=2;animationDuration=2.5;starFlashDuration=0.4;constructor(j){this.data={...j}}getData(){return this.data}getAnimationDuration(){return this.animationDuration}setOnAnimationComplete(j){this.onAnimationComplete=j}setOnConnectionRevealed(j){this.onConnectionRevealed=j}isDiscovered(){return this.data.discovered}addHoverTime(j){if(this.data.discovered||this.isAnimating)return!1;if(this.hoverTime+=j,this.discoveryProgress=Math.min(1,this.hoverTime/this.hoverTimeRequired),this.hoverTime>=this.hoverTimeRequired)return this.discover(),!0;return!1}resetHoverTime(){this.hoverTime=Math.max(0,this.hoverTime-0.1),this.discoveryProgress=this.hoverTime/this.hoverTimeRequired}discover(){this.data.discovered=!0,this.isAnimating=!0,this.animationTime=0,this.revealedConnections=0,this.starActivationTimes.clear()}update(j){if(!this.isAnimating)return;let J=this.animationTime===0;if(this.animationTime+=j,J&&this.data.connections.length>0){let Z=this.data.connections[0];if(Z){let[$]=Z;if($!==void 0){if(this.starActivationTimes.set($,this.animationTime),this.onConnectionRevealed)this.onConnectionRevealed(-1,this.data.connections.length)}}}let Q=Math.min(1,this.animationTime/this.animationDuration)*this.data.connections.length,V=Math.floor(Q);if(this.currentConnectionProgress=Q-V,V>this.revealedConnections)for(let Z=this.revealedConnections;Z<V;Z++){if(this.onConnectionRevealed)this.onConnectionRevealed(Z,this.data.connections.length);let $=this.data.connections[Z];if($){let[,B]=$;if(B!==void 0)this.starActivationTimes.set(B,this.animationTime)}}if(this.revealedConnections=V,this.animationTime>=this.animationDuration){if(this.isAnimating=!1,this.revealedConnections=this.data.connections.length,this.currentConnectionProgress=0,this.onAnimationComplete)this.onAnimationComplete(),this.onAnimationComplete=null,this.onConnectionRevealed=null}}render(j,J,U,Q,V){let Z=this.data.centerX-J+Q/2,$=this.data.centerY-U+V/2;if(Math.abs(Z-Q/2)>Q||Math.abs($-V/2)>V)return;if(this.data.discovered)this.renderDiscovered(j,J,U,Q,V);else if(this.discoveryProgress>0)this.renderHint(j,J,U,Q,V)}renderHint(j,J,U,Q,V){let Z=this.discoveryProgress*0.5;for(let $ of this.data.stars){let B=$.x-J+Q/2,M=$.y-U+V/2,K=Math.sin(Date.now()*0.005)*0.3+0.7,q=3+$.brightness*2;j.beginPath(),j.arc(B,M,q*3,0,Math.PI*2);let F=j.createRadialGradient(B,M,0,B,M,q*3);F.addColorStop(0,`rgba(255, 217, 61, ${Z*K*0.5})`),F.addColorStop(1,"rgba(255, 217, 61, 0)"),j.fillStyle=F,j.fill()}}renderDiscovered(j,J,U,Q,V){let Z=this.isAnimating&&this.revealedConnections===this.data.connections.length,$=0;if(Z){let q=(this.animationTime-this.animationDuration*0.9)/(this.animationDuration*0.1);$=Math.sin(q*Math.PI)*0.8}let B=this.isAnimating?0.8:0.6,M=B+$;j.strokeStyle=`rgba(255, 217, 61, ${M*0.7})`,j.lineWidth=1.5,j.lineCap="round";let K=this.isAnimating?this.revealedConnections:this.data.connections.length;for(let q=0;q<K;q++){let F=this.data.connections[q];if(!F)continue;let[k,N]=F,R=this.data.stars[k],E=this.data.stars[N];if(!R||!E)continue;let L=R.x-J+Q/2,_=R.y-U+V/2,z=E.x-J+Q/2,D=E.y-U+V/2;j.beginPath(),j.moveTo(L,_),j.lineTo(z,D),j.stroke()}if(this.isAnimating&&this.revealedConnections<this.data.connections.length){let q=this.data.connections[this.revealedConnections];if(q){let[F,k]=q,N=this.data.stars[F],R=this.data.stars[k];if(N&&R){let E=N.x-J+Q/2,L=N.y-U+V/2,_=R.x-J+Q/2,z=R.y-U+V/2,D=this.currentConnectionProgress,O=E+(_-E)*D,P=L+(z-L)*D;j.beginPath(),j.moveTo(E,L),j.lineTo(O,P),j.stroke()}}}for(let q=0;q<this.data.stars.length;q++){let F=this.data.stars[q];if(!F)continue;let k=F.x-J+Q/2,N=F.y-U+V/2,R=this.starActivationTimes.get(q),E=R!==void 0,L=3+F.brightness*3,_=B+$,z=1;if(this.isAnimating)if(!E)_*=0.3,L*=0.7;else{let O=this.animationTime-R;if(O<this.starFlashDuration){let P=O/this.starFlashDuration,G=Math.sin(P*Math.PI);L*=1+G*0.3,z=1+G*0.5,_=Math.min(1,_+G*0.2)}}j.beginPath(),j.arc(k,N,L*4*z,0,Math.PI*2);let D=j.createRadialGradient(k,N,0,k,N,L*4*z);D.addColorStop(0,`rgba(255, 217, 61, ${_*0.6})`),D.addColorStop(0.5,`rgba(255, 217, 61, ${_*0.2})`),D.addColorStop(1,"rgba(255, 217, 61, 0)"),j.fillStyle=D,j.fill(),j.beginPath(),j.arc(k,N,L,0,Math.PI*2),j.fillStyle=`rgba(255, 250, 230, ${_})`,j.fill()}if(!this.isAnimating){let q=this.data.centerX-J+Q/2,F=this.data.centerY-U+V/2;j.font='14px "Cormorant Garamond", serif',j.fillStyle="rgba(200, 210, 230, 0.6)",j.textAlign="center",j.fillText(this.data.name,q,F+this.data.radius+30)}}}class S{listElement;countElement;discoveries=[];constructor(){this.listElement=document.getElementById("discoveries-list"),this.countElement=document.querySelector(".discovery-count")}addDiscovery(j){this.discoveries.push(j),this.updateCount(),this.addCard(j);let J=document.getElementById("discoveries-toggle");if(J)J.classList.add("pulse"),setTimeout(()=>J.classList.remove("pulse"),500)}updateCount(){if(this.countElement)this.countElement.textContent=String(this.discoveries.length)}addCard(j){if(!this.listElement)return;let J=document.createElement("div");J.className="discovery-card",J.innerHTML=`
      <h3>${j.name}</h3>
      <p>${j.description||j.latinName||""}</p>
    `,J.style.opacity="0",J.style.transform="translateY(-20px)",this.listElement.prepend(J),requestAnimationFrame(()=>{J.style.transition="all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",J.style.opacity="1",J.style.transform="translateY(0)"})}getDiscoveries(){return this.discoveries}}class f{audioContext=null;masterGain=null;ambientGain=null;ambientNodes=[];isAmbientPlaying=!1;initialized=!1;constructor(){this.initOnInteraction()}initOnInteraction(){let j=()=>{this.ensureInitialized(),document.removeEventListener("click",j),document.removeEventListener("keydown",j),document.removeEventListener("mousemove",j)};document.addEventListener("click",j),document.addEventListener("keydown",j),document.addEventListener("mousemove",j)}ensureInitialized(){if(this.initialized&&this.audioContext){if(this.audioContext.state==="suspended")this.audioContext.resume();return!0}try{if(this.audioContext=new AudioContext,this.masterGain=this.audioContext.createGain(),this.masterGain.gain.value=0.3,this.masterGain.connect(this.audioContext.destination),this.ambientGain=this.audioContext.createGain(),this.ambientGain.gain.value=0,this.ambientGain.connect(this.masterGain),this.initialized=!0,console.log("\uD83D\uDD0A Audio initialized, state:",this.audioContext.state),this.audioContext.state==="suspended")this.audioContext.resume();return!0}catch(j){return console.warn("Audio initialization failed:",j),!1}}startAmbient(){if(this.isAmbientPlaying)return;if(!this.ensureInitialized()||!this.audioContext||!this.ambientGain)return;this.isAmbientPlaying=!0;let j=[55,82.5,110,165],J=this.audioContext.currentTime;for(let U of j){let Q=this.audioContext.createOscillator(),V=this.audioContext.createGain();Q.type="sine",Q.frequency.value=U,V.gain.value=0.02,Q.connect(V),V.connect(this.ambientGain),Q.start(),this.ambientNodes.push(Q)}this.ambientGain.gain.linearRampToValueAtTime(0.5,J+2)}stopAmbient(){if(!this.audioContext||!this.ambientGain)return;let j=this.audioContext.currentTime;this.ambientGain.gain.linearRampToValueAtTime(0,j+1),setTimeout(()=>{for(let J of this.ambientNodes)J.stop(),J.disconnect();this.ambientNodes=[],this.isAmbientPlaying=!1},1000)}playDiscoverySound(){if(!this.ensureInitialized()||!this.audioContext||!this.masterGain)return;let j=this.audioContext,J=j.currentTime,U=[523.25,659.25,783.99,1046.5],Q=0.15;for(let B=0;B<U.length;B++){let M=U[B];if(!M)continue;let K=j.createOscillator(),q=j.createGain();K.type="sine",K.frequency.value=M;let F=J+B*Q;q.gain.setValueAtTime(0,F),q.gain.linearRampToValueAtTime(0.3,F+0.02),q.gain.exponentialRampToValueAtTime(0.01,F+Q*2),K.connect(q),q.connect(this.masterGain),K.start(F),K.stop(F+Q*3)}let V=j.createOscillator(),Z=j.createGain();V.type="sine",V.frequency.value=523.25;let $=J+U.length*Q;Z.gain.setValueAtTime(0,$),Z.gain.linearRampToValueAtTime(0.4,$+0.1),Z.gain.exponentialRampToValueAtTime(0.01,$+1.5),V.connect(Z),Z.connect(this.masterGain),V.start($),V.stop($+2)}playStarConnectionSound(j,J){if(!this.ensureInitialized()||!this.audioContext||!this.masterGain)return;let U=this.audioContext,Q=U.currentTime,Z=400+j/J*400,$=U.createOscillator(),B=U.createGain();$.type="triangle",$.frequency.value=Z,B.gain.setValueAtTime(0,Q),B.gain.linearRampToValueAtTime(0.15,Q+0.01),B.gain.exponentialRampToValueAtTime(0.01,Q+0.2),$.connect(B),B.connect(this.masterGain),$.start(Q),$.stop(Q+0.3)}}var C=4000,b=2000,X=[{id:"orion",name:"Orion",latinName:"Orion",description:"The Hunter - One of the most recognizable constellations in the night sky.",centerX:800,centerY:600,radius:200,discovered:!1,stars:[{id:"betelgeuse",x:700,y:450,brightness:1},{id:"bellatrix",x:900,y:470,brightness:0.85},{id:"alnitak",x:770,y:600,brightness:0.8},{id:"alnilam",x:800,y:590,brightness:0.85},{id:"mintaka",x:830,y:580,brightness:0.8},{id:"saiph",x:720,y:750,brightness:0.75},{id:"rigel",x:880,y:770,brightness:0.95}],connections:[[0,1],[0,2],[1,4],[2,3],[3,4],[2,5],[4,6]]},{id:"ursa-major",name:"Ursa Major",latinName:"Ursa Major",description:"The Great Bear - Contains the famous Big Dipper asterism.",centerX:1800,centerY:400,radius:180,discovered:!1,stars:[{id:"dubhe",x:1650,y:320,brightness:0.9},{id:"merak",x:1680,y:420,brightness:0.85},{id:"phecda",x:1780,y:450,brightness:0.8},{id:"megrez",x:1820,y:380,brightness:0.7},{id:"alioth",x:1900,y:360,brightness:0.85},{id:"mizar",x:1970,y:340,brightness:0.9},{id:"alkaid",x:2050,y:380,brightness:0.88}],connections:[[0,1],[1,2],[2,3],[3,0],[3,4],[4,5],[5,6]]},{id:"cassiopeia",name:"Cassiopeia",latinName:"Cassiopeia",description:"The Queen - Easily recognized by its distinctive W shape.",centerX:2800,centerY:300,radius:140,discovered:!1,stars:[{id:"schedar",x:2650,y:280,brightness:0.9},{id:"caph",x:2720,y:350,brightness:0.85},{id:"gamma-cas",x:2800,y:260,brightness:0.95},{id:"ruchbah",x:2880,y:340,brightness:0.8},{id:"segin",x:2950,y:290,brightness:0.75}],connections:[[0,1],[1,2],[2,3],[3,4]]},{id:"cygnus",name:"Cygnus",latinName:"Cygnus",description:"The Swan - Also known as the Northern Cross.",centerX:1200,centerY:1200,radius:160,discovered:!1,stars:[{id:"deneb",x:1200,y:1050,brightness:1},{id:"sadr",x:1200,y:1180,brightness:0.85},{id:"gienah",x:1100,y:1220,brightness:0.75},{id:"delta-cyg",x:1300,y:1230,brightness:0.78},{id:"albireo",x:1200,y:1350,brightness:0.8}],connections:[[0,1],[1,4],[1,2],[1,3]]},{id:"lyra",name:"Lyra",latinName:"Lyra",description:"The Lyre - Home to Vega, one of the brightest stars.",centerX:2400,centerY:900,radius:100,discovered:!1,stars:[{id:"vega",x:2400,y:820,brightness:1},{id:"sulafat",x:2380,y:920,brightness:0.7},{id:"sheliak",x:2420,y:930,brightness:0.72},{id:"delta-lyr",x:2360,y:990,brightness:0.65},{id:"zeta-lyr",x:2440,y:980,brightness:0.68}],connections:[[0,1],[0,2],[1,2],[1,3],[2,4],[3,4]]},{id:"scorpius",name:"Scorpius",latinName:"Scorpius",description:"The Scorpion - Features the red supergiant Antares.",centerX:3200,centerY:1400,radius:200,discovered:!1,stars:[{id:"antares",x:3100,y:1300,brightness:1},{id:"graffias",x:3000,y:1200,brightness:0.75},{id:"dschubba",x:3050,y:1250,brightness:0.8},{id:"sigma-sco",x:3150,y:1380,brightness:0.7},{id:"tau-sco",x:3200,y:1450,brightness:0.72},{id:"sargas",x:3280,y:1520,brightness:0.78},{id:"shaula",x:3350,y:1580,brightness:0.85}],connections:[[1,2],[2,0],[0,3],[3,4],[4,5],[5,6]]}];class W{canvas;ctx;telescopeOverlay;state;starField;telescope;constellations;discoveriesTab;audioManager;lastFrameTime=0;animationFrameId=0;constructor(j,J){this.canvas=j,this.telescopeOverlay=J;let U=j.getContext("2d");if(!U)throw Error("Could not get 2D context");this.ctx=U,this.state={running:!1,mouseX:window.innerWidth/2,mouseY:window.innerHeight/2,viewX:C/2,viewY:b/2,discoveredCount:0},this.starField=new A(C,b),this.telescope=new I(J),this.constellations=X.map((Q)=>new y(Q)),this.discoveriesTab=new S,this.audioManager=new f,this.setupEventListeners(),this.resizeCanvas()}setupEventListeners(){window.addEventListener("mousemove",(U)=>{this.state.mouseX=U.clientX,this.state.mouseY=U.clientY}),window.addEventListener("resize",()=>this.resizeCanvas());let j=document.getElementById("discoveries-toggle"),J=document.getElementById("discoveries-panel");if(j&&J)j.addEventListener("click",()=>{J.classList.toggle("collapsed")})}resizeCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}start(){this.state.running=!0,this.lastFrameTime=performance.now(),this.audioManager.startAmbient(),this.gameLoop()}stop(){if(this.state.running=!1,this.animationFrameId)cancelAnimationFrame(this.animationFrameId);this.audioManager.stopAmbient()}gameLoop=()=>{if(!this.state.running)return;let j=performance.now(),J=(j-this.lastFrameTime)/1000;this.lastFrameTime=j,this.update(J),this.render(),this.animationFrameId=requestAnimationFrame(this.gameLoop)};update(j){this.telescope.update(this.state.mouseX,this.state.mouseY,j);let J=this.telescope.getPosition(),U=(J.x-window.innerWidth/2)*0.5,Q=(J.y-window.innerHeight/2)*0.5;this.state.viewX+=U*j,this.state.viewY+=Q*j;let V=400;this.state.viewX=Math.max(V,Math.min(C-V,this.state.viewX)),this.state.viewY=Math.max(V,Math.min(b-V,this.state.viewY)),this.checkConstellationDiscovery(j);for(let Z of this.constellations)Z.update(j)}checkConstellationDiscovery(j){let J=this.telescope.getPosition(),U=this.telescope.getRadius(),Q=this.state.viewX+(J.x-window.innerWidth/2),V=this.state.viewY+(J.y-window.innerHeight/2);for(let Z of this.constellations){if(Z.isDiscovered())continue;let $=Z.getData();if(Math.hypot(Q-$.centerX,V-$.centerY)<$.radius+U*0.3){if(Z.addHoverTime(j))this.onConstellationDiscovered(Z)}else Z.resetHoverTime()}}onConstellationDiscovered(j){let J=j.getData();this.state.discoveredCount++,j.setOnConnectionRevealed((U,Q)=>{this.audioManager.playStarConnectionSound(U,Q)}),j.setOnAnimationComplete(()=>{this.audioManager.playDiscoverySound(),this.discoveriesTab.addDiscovery(J),this.showDiscoveryNotification(J.name)})}showDiscoveryNotification(j){let J=document.getElementById("discovery-notification"),U=J?.querySelector(".constellation-name");if(J&&U)J.classList.remove("hidden"),U.textContent=j,requestAnimationFrame(()=>{J.classList.add("visible")}),setTimeout(()=>{J.classList.remove("visible"),setTimeout(()=>{J.classList.add("hidden")},500)},3000)}render(){let{ctx:j,canvas:J}=this,{viewX:U,viewY:Q}=this.state;j.fillStyle="#050510",j.fillRect(0,0,J.width,J.height);let V=this.telescope.getPosition(),Z=this.telescope.getRadius();j.save(),j.beginPath(),j.arc(V.x,V.y,Z,0,Math.PI*2),j.clip(),this.starField.render(j,U,Q,J.width,J.height,V);for(let $ of this.constellations)$.render(j,U,Q,J.width,J.height);j.restore(),this.renderBackgroundStars()}renderBackgroundStars(){let{ctx:j,canvas:J}=this,U=this.telescope.getPosition(),Q=this.telescope.getRadius(),V=this.starField.getBackgroundStars();j.save(),j.beginPath(),j.rect(0,0,J.width,J.height),j.arc(U.x,U.y,Q+30,0,Math.PI*2,!0),j.clip();for(let Z of V){let $=Z.x/C*J.width,B=Z.y/b*J.height;j.beginPath(),j.arc($,B,Z.size*0.5,0,Math.PI*2),j.fillStyle=`rgba(200, 210, 255, ${Z.brightness*0.3})`,j.fill()}j.restore()}}document.addEventListener("DOMContentLoaded",()=>{let j=document.getElementById("sky-canvas"),J=document.getElementById("telescope-overlay"),U=document.getElementById("start-screen"),Q=document.getElementById("start-button");if(!j||!J){console.error("Required elements not found");return}let V=new W(j,J);Q?.addEventListener("click",()=>{U.classList.add("hidden"),V.start()})});
